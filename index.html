<!DOCTYPE html>
<html lang="fr" class="scroll-smooth antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- SEO & Identity -->
    <title>Laforêt Saint-Avertin | Estimation DVF & Marché Local</title>
    <meta name="description" content="Obtenez la valeur réelle de votre bien basée sur les données DVF de l'État et les ventes récentes à Saint-Avertin. Estimation en ligne immédiate.">
    
    <!-- Favicons & App Icons (Standard Google/Apple) -->
    <link rel="icon" type="image/png" href="https://i.postimg.cc/PJbhCjdD/logo-devant-flocage.png">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/PJbhCjdD/logo-devant-flocage.png">
    <link rel="shortcut icon" type="image/png" href="https://i.postimg.cc/PJbhCjdD/logo-devant-flocage.png">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Estimation DVF - Laforêt Saint-Avertin">
    <meta property="og:description" content="Accédez aux prix réels des ventes notaires dans votre rue.">
    <meta property="og:image" content="https://i.postimg.cc/PJbhCjdD/logo-devant-flocage.png">
    <meta property="og:type" content="website">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-11283228533"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-11283228533');
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        laforet: {
                            navy: '#183C89', // Primary Brand
                            cyan: '#00AFED', // Action
                            bg: '#F5F5F7',   // Apple Surface
                        }
                    },
                    boxShadow: {
                        'apple': '0 4px 24px -1px rgba(0, 0, 0, 0.04)',
                        'apple-hover': '0 8px 32px -4px rgba(0, 0, 0, 0.08)',
                        'glow': '0 0 20px rgba(0, 175, 237, 0.25)',
                    },
                    animation: {
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0?dev",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client?dev",
            "framer-motion": "https://esm.sh/framer-motion@10.16.4?dev&deps=react@18.2.0,react-dom@18.2.0",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0?dev&deps=react@18.2.0"
        }
    }
    </script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        *::-webkit-scrollbar { display: none; }
        * { scrollbar-width: none; -ms-overflow-style: none; }
        html, body {
            background-color: #F5F5F7;
            color: #183C89;
            overflow-y: scroll;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        .map-blur-bg {
            background-image: url('https://i.postimg.cc/qMVcnC6Y/Generated-Image-December-31-2025-11-37AM.jpg');
            background-size: cover;
            background-position: center;
            filter: blur(8px);
            -webkit-filter: blur(8px);
        }
        /* Utilities for horizontal scroll */
        .snap-x-mandatory { scroll-snap-type: x mandatory; }
        .snap-center { scroll-snap-align: center; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Custom Chart Bars */
        .bar-container {
            position: relative;
            height: 12px;
            background: #e5e7eb;
            border-radius: 99px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            border-radius: 99px;
            transition: width 1s ease-out;
        }
    </style>
</head>
<body>
    <div id="root">
        <!-- SKELETON SCREEN -->
        <div class="min-h-screen bg-[#F5F5F7] flex flex-col">
            <div class="h-14 md:h-20 bg-white border-b border-gray-200 flex items-center justify-between px-6 sticky top-0 z-50">
                <div class="w-24 h-8 bg-gray-200 rounded skeleton"></div>
            </div>
            <div class="flex-1 flex flex-col items-center justify-center p-6 space-y-6">
                <div class="w-3/4 h-12 bg-gray-300 rounded-lg skeleton"></div>
                <div class="w-1/2 h-6 bg-gray-200 rounded skeleton"></div>
            </div>
        </div>
    </div>

    <!-- Hidden Netlify Form -->
    <form name="estimation-dvf" method="POST" netlify data-netlify="true" netlify-honeypot="bot-field" hidden>
        <input type="hidden" name="form-name" value="estimation-dvf" />
        <input type="hidden" name="bot-field" />
        <input type="text" name="address" />
        <input type="text" name="city" />
        <input type="text" name="zipcode" />
        <input type="text" name="type" />
        <input type="text" name="surface" />
        <input type="text" name="rooms" />
        <input type="text" name="boosters" />
        <input type="text" name="flaws" />
        <input type="text" name="name" />
        <input type="tel" name="phone" />
        <input type="email" name="email" />
    </form>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { motion, AnimatePresence } from 'framer-motion';
        import { 
            Phone, MapPin, Home, Building2, ArrowRight, CheckCircle2, 
            Users, Star, TrendingUp, CalendarClock, ChevronRight, 
            Database, Search, Check, AlertCircle, Loader2, Lock, FileBarChart,
            Download, BarChart3, ShieldCheck, FileText
        } from 'lucide-react';

        // --- DATA ---
        const googleReviews = [
            {
                author: "Francis DUPONT",
                rating: 5,
                comment: "Nous avons contacté l’agence Laforêt de Saint-Avertin afin d’obtenir une estimation de notre bien immobilier. Malgré cela nous avons obtenu un RDV très rapide. Et avons reçu Vincent, qui s’est montré très professionnel."
            },
            {
                author: "Claude ADR",
                rating: 5,
                comment: "Très bonne rencontre avec l'agence pour un avis de valeur. Le premier contact téléphonique a été très sympathique, suivi d'une rencontre très chaleureuse et professionnelle."
            },
            {
                author: "Ugo Clerici",
                rating: 5,
                comment: "Une agence familiale, réactive, disponible et à l'écoute du besoin du client. Des visites et contre-visites ont été réalisées avec Vincent, Adrien et Olivier."
            },
            {
                author: "Christophe Fontaine",
                rating: 5,
                comment: "Une belle équipe familiale dynamique, sympathique et hyper efficace. Deux biens vendus rapidement en quelques semaines et « au prix ». Bravo à tous !"
            },
            {
                author: "Seb Decout",
                rating: 5,
                comment: "Nous tenons à remercier chaleureusement l'agence LaFORÊT. Olivier a su nous guider avec une connaissance approfondie du terrain, Vincent a été d’une réactivité sans faille."
            },
            {
                author: "Céline M",
                rating: 5,
                comment: "Une entreprise familiale extraordinaire : ils ont réussi à vendre mon appartement en moins d’une semaine alors que seul j’ai attendu pratiquement un an."
            }
        ];

        // --- COMPONENTS ---

        const Navbar = () => (
            <motion.nav 
                initial={{ y: -100 }}
                animate={{ y: 0 }}
                className="fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-sm md:bg-white shadow-sm border-b border-gray-100"
            >
                <div className="max-w-7xl mx-auto px-4 md:px-6 h-16 md:h-20 flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <img src="https://i.postimg.cc/PJbhCjdD/logo-devant-flocage.png" alt="Laforêt" className="h-6 md:h-10 w-auto object-contain" />
                         <div className="hidden md:flex flex-col">
                            <span className="text-sm font-bold text-laforet-navy tracking-tight">AGENCE LaFORÊT</span>
                            <span className="text-xs text-gray-500 font-medium">Saint-Avertin & Larçay</span>
                        </div>
                    </div>
                    {/* Desktop Button */}
                    <a href="tel:0246466380" className="hidden md:flex items-center gap-2 px-5 py-2.5 rounded-full bg-laforet-navy text-white font-bold text-sm shadow-md hover:bg-opacity-90">
                        <Phone size={18} />
                        <span>02 46 46 63 80</span>
                    </a>
                    {/* Mobile Button - Minimal Round */}
                    <a href="tel:0246466380" className="md:hidden w-10 h-10 rounded-full bg-laforet-navy text-white flex items-center justify-center shadow-none">
                        <Phone size={20} />
                    </a>
                </div>
            </motion.nav>
        );

        const Methodology = ({ isMobile }) => {
            if (isMobile) {
                return (
                    <div className="grid grid-cols-3 gap-2 mt-8 w-full">
                        <div className="flex flex-col items-center gap-1.5 p-2 bg-white/5 rounded-lg border border-white/10 backdrop-blur-sm">
                            <Database size={20} className="text-white" />
                            <span className="text-[10px] text-white font-medium leading-tight">Données<br/>État (DVF)</span>
                        </div>
                        <div className="flex flex-col items-center gap-1.5 p-2 bg-white/5 rounded-lg border border-white/10 backdrop-blur-sm">
                            <Building2 size={20} className="text-white" />
                            <span className="text-[10px] text-white font-medium leading-tight">Ventes<br/>Agence</span>
                        </div>
                        <div className="flex flex-col items-center gap-1.5 p-2 bg-white/5 rounded-lg border border-white/10 backdrop-blur-sm">
                            <Check size={20} className="text-white" />
                            <span className="text-[10px] text-white font-medium leading-tight">Vos<br/>Atouts</span>
                        </div>
                    </div>
                );
            }

            return (
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8 w-full max-w-4xl mx-auto px-4">
                    <div className="bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-xl flex items-center md:items-start gap-4 text-left">
                        <div className="bg-white text-laforet-navy p-2 rounded-lg shrink-0"><Database size={24} /></div>
                        <div>
                            <h4 className="font-bold text-white text-sm">Source A : DVF</h4>
                            <p className="text-white/80 text-xs leading-snug">Données officielles de l'État (Notaires).</p>
                        </div>
                    </div>
                    <div className="bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-xl flex items-center md:items-start gap-4 text-left">
                        <div className="bg-white text-laforet-navy p-2 rounded-lg shrink-0"><Building2 size={24} /></div>
                        <div>
                            <h4 className="font-bold text-white text-sm">Source B : Agence</h4>
                            <p className="text-white/80 text-xs leading-snug">Ventes récentes Laforêt dans votre rue.</p>
                        </div>
                    </div>
                    <div className="bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-xl flex items-center md:items-start gap-4 text-left">
                        <div className="bg-white text-laforet-navy p-2 rounded-lg shrink-0"><Check size={24} /></div>
                        <div>
                            <h4 className="font-bold text-white text-sm">Source C : Vos Atouts</h4>
                            <p className="text-white/80 text-xs leading-snug">Rénovations et options valorisantes.</p>
                        </div>
                    </div>
                </div>
            );
        };

        const Hero = ({ onStart }) => (
            <section className="relative min-h-screen md:min-h-[700px] flex flex-col items-center justify-center overflow-hidden">
                <div className="absolute inset-0 z-0">
                    <img src="https://i.postimg.cc/qMVcnC6Y/Generated-Image-December-31-2025-11-37AM.jpg" alt="Terrasse" className="w-full h-full object-cover object-center" />
                    {/* DESKTOP OVERLAY */}
                    <div className="hidden md:block absolute inset-0 bg-black/50" />
                    {/* MOBILE OVERLAY (GRADIENT PROGRESSIF) */}
                    <div className="md:hidden absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-black/25" />
                </div>

                {/* Visible ONLY on Desktop */}
                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="hidden md:flex relative z-20 w-full max-w-5xl mx-auto px-4 text-center flex-col justify-center h-full pt-20 pb-20">
                    <div className="inline-flex items-center justify-center gap-2 bg-laforet-cyan/20 backdrop-blur-sm border border-laforet-cyan/30 rounded-full px-4 py-1.5 mb-6 mx-auto">
                        <span className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                        <span className="text-white text-xs font-bold tracking-wide uppercase">Données Ventes 2025/2026 à jour</span>
                    </div>

                    <h1 className="text-5xl font-extrabold text-white tracking-tight leading-tight mb-6 drop-shadow-xl">
                        Quelle est la valeur réelle de votre bien selon les <span className="text-laforet-cyan">dernières ventes de l'État</span> ?
                    </h1>

                    <p className="text-xl text-gray-200 max-w-2xl mx-auto mb-10 font-normal leading-relaxed">
                        Accédez instantanément à une estimation basée sur les transactions réelles de votre rue à Saint-Avertin ou Larçay.
                    </p>

                    <Methodology isMobile={false} />
                </motion.div>
            </section>
        );

        // --- CUSTOM ADDRESS COMPONENT ---
        const AddressAutocomplete = ({ onSelect, mobileMode = false }) => {
            const [query, setQuery] = useState("");
            const [suggestions, setSuggestions] = useState([]);
            const [isOpen, setIsOpen] = useState(false);
            const wrapperRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (wrapperRef.current && !wrapperRef.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            useEffect(() => {
                if (query.length > 3) {
                    const fetchAddress = async () => {
                        try {
                            const response = await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(query)}&limit=5`);
                            const data = await response.json();
                            setSuggestions(data.features || []);
                            setIsOpen(true);
                        } catch (e) {
                            console.error("Erreur API Adresse", e);
                        }
                    };
                    // Debounce simple
                    const timeoutId = setTimeout(fetchAddress, 300);
                    return () => clearTimeout(timeoutId);
                } else {
                    setSuggestions([]);
                    setIsOpen(false);
                }
            }, [query]);

            const handleSelect = (feature) => {
                setQuery(feature.properties.label);
                setIsOpen(false);
                onSelect({
                    fullAddress: feature.properties.label,
                    city: feature.properties.city,
                    zipcode: feature.properties.postcode,
                    street: feature.properties.name,
                    coordinates: feature.geometry.coordinates
                });
            };

            return (
                <div ref={wrapperRef} className="relative group w-full">
                    {/* Search Icon Hidden on Mobile for cleaner look? No, kept for affordance but minimal */}
                    <Search className={`absolute left-4 top-1/2 -translate-y-1/2 transition-colors ${mobileMode ? 'text-gray-500' : 'text-gray-400 group-focus-within:text-laforet-cyan'}`} size={20} />
                    <input 
                        type="text" 
                        placeholder="Saisissez votre adresse..." 
                        className={`w-full pl-11 pr-4 bg-white outline-none transition-all ${
                            mobileMode 
                            ? 'py-4 rounded-xl text-base font-medium shadow-sm border border-gray-200' 
                            : 'py-5 border-0 md:border md:border-gray-200 rounded-xl text-lg font-medium focus:ring-4 focus:ring-laforet-cyan/20 focus:border-laforet-cyan shadow-xl md:shadow-lg'
                        }`}
                        value={query}
                        onChange={(e) => setQuery(e.target.value)}
                        autoFocus={false}
                    />
                    
                    {isOpen && suggestions.length > 0 && (
                        <div className="absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-2xl border border-gray-100 z-50 overflow-hidden max-h-64 overflow-y-auto">
                            {suggestions.map((s, i) => (
                                <div 
                                    key={i} 
                                    className="p-4 hover:bg-blue-50 cursor-pointer flex items-center gap-4 border-b border-gray-50 last:border-0 transition-colors"
                                    onClick={() => handleSelect(s)}
                                >
                                    <div className="bg-gray-100 p-2.5 rounded-full text-gray-500">
                                        <MapPin size={20} />
                                    </div>
                                    <div className="text-left">
                                        <p className="text-base font-bold text-gray-900">{s.properties.name}</p>
                                        <p className="text-sm text-gray-500">{s.properties.postcode} {s.properties.city}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const FormEngine = () => {
            const [step, setStep] = useState(0); 
            const [data, setData] = useState({ 
                address: '', city: '', zipcode: '', street: '', type: 'Maison', surface: '', rooms: '', 
                boosters: [], flaws: [], name: '', phone: '', email: '' 
            });
            const [isSimulatingCalc, setIsSimulatingCalc] = useState(false);
            const [loadingProgress, setLoadingProgress] = useState(0);
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [loadingText, setLoadingText] = useState("Connexion serveur...");
            const [resultData, setResultData] = useState(null);

            const handleAddressSelect = (addressData) => {
                setData({
                    ...data,
                    address: addressData.fullAddress,
                    city: addressData.city,
                    zipcode: addressData.zipcode,
                    street: addressData.street
                });
            };

            const triggerCalc = () => {
                setIsSimulatingCalc(true);
                setTimeout(() => setIsSimulatingCalc(false), 600);
            };

            const toggleItem = (list, item) => {
                const newList = data[list].includes(item) 
                    ? data[list].filter(i => i !== item) 
                    : [...data[list], item];
                setData({ ...data, [list]: newList });
                triggerCalc();
            };

            const next = () => {
                // Scroll only on Desktop. Mobile is full screen.
                if (window.innerWidth >= 768) {
                    window.scrollTo({ top: document.getElementById('simulator').offsetTop - 80, behavior: 'smooth' });
                }
                setStep(s => s + 1);
            };

            // --- LE CERVEAU ESTIMATEUR (LOGIQUE INTERNE) ---
            const calculateEstimation = () => {
                // 1. DÉTERMINATION DU MICRO-MARCHÉ (Section 3)
                // Analyse syntaxique de l'adresse pour déterminer le quartier
                const addressStr = (data.address + " " + data.city).toLowerCase();
                let neighborhood = 'st_avertin_default';

                if (addressStr.includes('larçay') || addressStr.includes('larcay')) {
                    neighborhood = 'larcay';
                } else if (addressStr.includes('cangé') || addressStr.includes('cange') || addressStr.includes('aubinière')) {
                    neighborhood = 'cange';
                } else if (addressStr.includes('onze arpents') || addressStr.includes('11 arpents')) {
                    neighborhood = 'onze_arpents';
                } else if (addressStr.includes('grand village') || addressStr.includes('cigognes')) {
                    neighborhood = 'grand_village';
                } else if (addressStr.includes('vieux') || addressStr.includes('bourg')) {
                    neighborhood = 'vieux_st_avertin';
                }

                // 2. PRIX DE RÉFÉRENCE (Section 3.1 PDF)
                // Données Data 2025/2026
                const priceMatrix = {
                    cange: { maison: 2985, appt: 2618 },
                    grand_village: { maison: 2700, appt: 2369 },
                    onze_arpents: { maison: 2700, appt: 2539 },
                    vieux_st_avertin: { maison: 2800, appt: 2400 },
                    larcay: { maison: 2400, appt: 2220 },
                    st_avertin_default: { maison: 2850, appt: 2450 }
                };

                const typeKey = data.type === 'Appartement' ? 'appt' : 'maison';
                const basePriceM2 = priceMatrix[neighborhood][typeKey];

                // 3. SURFACE PONDÉRÉE & CALCUL BRUT (Section 2.1 & 2.2)
                let totalSurface = parseInt(data.surface) || 0;
                let weightedPrice = basePriceM2 * totalSurface;

                // 4. COEFFICIENTS QUALITATIFS (Section 2.2 & 2.4 - Hédonisme)
                let qualityCoeff = 0;

                // Terrasse/Balcon (Pondération approx +5%)
                if (data.boosters.includes("Terrasse / Balcon")) qualityCoeff += 0.05;
                // Jardin sans vis-à-vis (Hédonisme fort)
                if (data.boosters.includes("Jardin sans vis-à-vis")) qualityCoeff += 0.08;
                // Calme absolu (Valeur refuge)
                if (data.boosters.includes("Calme absolu")) qualityCoeff += 0.05;
                // Proximité (Walkability Onze Arpents)
                if (data.boosters.includes("Proche Commerces")) qualityCoeff += 0.03;
                // DPE A/B/C (Valeur Verte)
                if (data.boosters.includes("DPE A/B/C")) qualityCoeff += 0.05;
                
                // Garage : Valeur Forfaitaire (+15 000€ selon PDF)
                let fixedBonus = 0;
                if (data.boosters.includes("Garage / Parking")) fixedBonus += 15000;
                // Piscine (Non demandé explicitement mais si "Cuisine récente" + "Jardin" on peut supposer un standing)
                // On reste prudent, on n'ajoute pas de piscine fantôme.

                // 5. COEFFICIENTS DE VÉTUSTÉ (Section 2.1)
                let vetusteCoeff = 0;
                if (data.flaws.includes("Travaux à prévoir")) vetusteCoeff += 0.10;
                if (data.flaws.includes("Rue passante")) vetusteCoeff += 0.05; // Nuisance acoustique
                if (data.flaws.includes("Rez-de-chaussée (Appt)")) vetusteCoeff += 0.05;
                if (data.flaws.includes("Électricité ancienne")) vetusteCoeff += 0.05;
                
                // Simulation DPE F/G si cumul de défauts
                if (data.flaws.includes("Travaux à prévoir") && data.flaws.includes("Électricité ancienne")) {
                    vetusteCoeff += 0.10; // Malus Passoire Thermique
                }

                // CALCUL FINAL FORMULE MAITRESSE
                // P_est = (S_pond * P_ref) * (1 + Coeff_qual) * (1 - Coeff_vetuste) + FixedBonus
                let estimatedPrice = (weightedPrice * (1 + qualityCoeff) * (1 - vetusteCoeff)) + fixedBonus;

                // 6. GESTION DE L'INCERTITUDE & FOURCHETTE (Section 2.5 & 4.1)
                // STRATÉGIE "GAP DE CURIOSITÉ" : Indice de confiance toujours faible (2/5)
                // pour inciter au RDV physique.
                let confidenceIndex = 2; // FORCE A 2
                
                let rangePercentage = 0.08; // Base +/- 8%

                // Si bien atypique ou "Travaux" -> On élargit la fourchette
                if (data.flaws.includes("Travaux à prévoir") || neighborhood === 'cange') {
                    rangePercentage = 0.12; // +/- 12%
                }

                const low = Math.round((estimatedPrice * (1 - rangePercentage)) / 1000) * 1000;
                const high = Math.round((estimatedPrice * (1 + rangePercentage)) / 1000) * 1000;

                return {
                    low,
                    high,
                    avgM2: Math.round(estimatedPrice / totalSurface),
                    confidence: confidenceIndex,
                    neighborhoodLabel: neighborhood.replace(/_/g, ' ').toUpperCase()
                };
            };

            // Animation de chargement Step 4 (initiale)
            useEffect(() => {
                if (step === 4) {
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += Math.random() * 15;
                        if (progress > 100) {
                            progress = 100;
                            clearInterval(interval);
                            setTimeout(() => setStep(5), 500);
                        }
                        setLoadingProgress(Math.min(progress, 100));
                    }, 300);
                    return () => clearInterval(interval);
                }
            }, [step]);

            // Animation de chargement FINALE (Step 6) - Séquence "Cerveau"
            useEffect(() => {
                if (step === 6) {
                    const texts = [
                        "Connexion Base DVF (Notaires)...",
                        "Analyse des micro-quartiers (Cangé, Larçay...)...",
                        "Calcul des coefficients hédonistes...",
                        "Vérification des indices de tension...",
                        "Génération de la fourchette de confiance..."
                    ];
                    let i = 0;
                    const interval = setInterval(() => {
                        setLoadingText(texts[i]);
                        i++;
                        if (i >= texts.length) i = texts.length - 1;
                    }, 800); 

                    const timeout = setTimeout(() => {
                        const results = calculateEstimation();
                        setResultData(results);
                        setStep(7);
                        if (window.innerWidth >= 768) {
                            window.scrollTo({ top: document.getElementById('simulator').offsetTop - 80, behavior: 'smooth' });
                        }
                    }, 4000); // 4s pour crédibiliser le calcul complexe

                    return () => {
                        clearInterval(interval);
                        clearTimeout(timeout);
                    };
                }
            }, [step]);

            const handleSubmit = (e) => {
                e.preventDefault();
                setIsSubmitting(true);
                
                const encode = (data) => Object.keys(data).map(key => encodeURIComponent(key) + "=" + encodeURIComponent(data[key])).join("&");
                
                fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: encode({ "form-name": "estimation-dvf", ...data })
                }).then(() => {
                    if (window.gtag) window.gtag('event', 'conversion', { 'send_to': 'AW-11283228533/la_CCNLGi9sbEPXOoYQq' });
                }).catch(err => console.error("Erreur envoi formulaire:", err));

                setIsSubmitting(false);
                setStep(6); 
                if (window.innerWidth >= 768) {
                    window.scrollTo({ top: document.getElementById('simulator').offsetTop - 80, behavior: 'smooth' });
                }
            };

            const BoostersList = ["Cuisine récente", "Terrasse / Balcon", "Jardin sans vis-à-vis", "Garage / Parking", "Calme absolu", "Proche Commerces", "DPE A/B/C"];
            const FlawsList = ["Travaux à prévoir", "Vis-à-vis important", "Rue passante", "Rez-de-chaussée (Appt)", "Électricité ancienne", "Isolation à revoir"];

            return (
                <section id="simulator" className={`
                    ${step === 0 ? 'md:relative md:z-30 md:-mt-10 md:pb-20 absolute top-0 inset-x-0 min-h-screen flex flex-col justify-end md:justify-center z-20' : ''}
                    ${step > 0 ? 'md:relative md:z-30 md:-mt-10 md:pb-20 absolute inset-0 bg-white z-50 flex flex-col' : ''}
                `}>
                    <div className={`
                        ${step > 0 ? 'h-full flex flex-col' : ''}
                        md:max-w-xl md:mx-auto md:bg-white md:rounded-2xl md:shadow-2xl md:overflow-hidden md:border md:border-gray-100 md:block
                        w-full
                    `}>
                        
                        {/* HEADER DU CARD (Desktop Only ou Mobile Step > 0) */}
                        <div className={`
                             ${step === 0 ? 'hidden md:flex' : 'flex'}
                             bg-white md:bg-gray-50 border-b border-gray-100 px-6 py-4 items-center justify-between shrink-0
                        `}>
                            <div className="flex items-center gap-2">
                                <span className="flex h-2.5 w-2.5 relative">
                                    <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                    <span className="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
                                </span>
                                <span className="text-xs font-bold text-laforet-navy uppercase tracking-wider">Simulateur en ligne</span>
                            </div>
                            <div className="text-xs text-gray-400 font-medium hidden md:block">Déjà +150 estimations</div>
                        </div>

                        {step < 6 && (
                            <div className="w-full bg-gray-100 h-1 md:h-2 shrink-0 hidden md:block">
                                <motion.div 
                                    className="bg-laforet-cyan h-full" 
                                    initial={{ width: 0 }} 
                                    animate={{ width: `${(step / 5) * 100}%` }} 
                                />
                            </div>
                        )}

                        <div className={`
                            p-6 md:p-8 flex-grow flex flex-col justify-center relative
                            ${step === 0 ? 'bg-transparent justify-end pb-10' : 'bg-white'}
                        `}>
                            
                            <AnimatePresence>
                                {isSimulatingCalc && (
                                    <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="absolute inset-0 z-50 bg-white/80 backdrop-blur-[1px] flex items-center justify-center">
                                        <div className="flex items-center gap-2 bg-laforet-navy text-white px-4 py-2 rounded-full shadow-lg">
                                            <Loader2 className="animate-spin" size={16} />
                                            <span className="text-xs font-bold">Mise à jour du prix...</span>
                                        </div>
                                    </motion.div>
                                )}
                            </AnimatePresence>

                            <AnimatePresence mode="wait">
                                {step === 0 && (
                                    <motion.div key="step0" initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} className="space-y-6 md:space-y-6 w-full">
                                        
                                        {/* MOBILE HERO CONTENT */}
                                        <div className="md:hidden flex flex-col items-center text-center">
                                            {/* Badge */}
                                            <div className="inline-flex items-center justify-center gap-2 bg-white/10 backdrop-blur-md border border-white/20 rounded-full px-3 py-1 mb-4">
                                                <span className="w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"></span>
                                                <span className="text-white text-[10px] font-bold tracking-wide uppercase">Données Ventes 2025/2026 à jour</span>
                                            </div>

                                            {/* Title */}
                                            <h1 className="text-[28px] leading-[1.2] font-extrabold text-white tracking-tight mb-3">
                                                Quelle est la valeur de votre bien selon les <span className="text-laforet-cyan">dernières ventes de l'État</span> ?
                                            </h1>

                                            {/* Subtitle */}
                                            <p className="text-sm text-white/85 max-w-xs mx-auto mb-6 leading-relaxed">
                                                Estimation instantanée basée sur les transactions réelles de votre rue à Saint-Avertin ou Larçay.
                                            </p>

                                            {/* MAIN ACTION: INPUT + BUTTON */}
                                            <div className="w-full bg-white rounded-2xl p-2 shadow-2xl space-y-2">
                                                <AddressAutocomplete onSelect={handleAddressSelect} mobileMode={true} />
                                                <button onClick={next} disabled={!data.address} className="w-full bg-laforet-navy text-white font-bold h-[52px] rounded-xl disabled:opacity-50 disabled:cursor-not-allowed active:scale-95 transition-all flex justify-center gap-2 items-center text-base shadow-lg">
                                                    Lancer mon estimation en ligne <ArrowRight size={20} />
                                                </button>
                                            </div>

                                            {/* METHODOLOGY (Mobile Compact) */}
                                            <Methodology isMobile={true} />
                                        </div>

                                        {/* DESKTOP CONTENT (Original) */}
                                        <div className="text-center space-y-2 hidden md:block">
                                            <h3 className="text-2xl md:text-3xl font-bold text-laforet-navy">Où se situe le bien ?</h3>
                                            <p className="text-sm text-gray-500">Nous analysons les ventes DVF dans un rayon de 500m.</p>
                                        </div>
                                        
                                        <div className="hidden md:block">
                                            <AddressAutocomplete onSelect={handleAddressSelect} />
                                        </div>

                                        {data.address && (
                                            <motion.div initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} className="hidden md:flex bg-blue-50 border border-blue-100 rounded-xl p-4 items-center gap-3">
                                                <div className="bg-white p-2 rounded-full text-green-500 shadow-sm"><CheckCircle2 size={20} /></div>
                                                <div>
                                                    <p className="font-bold text-laforet-navy text-sm">{data.address}</p>
                                                    <p className="text-xs text-blue-600">Adresse localisée avec succès</p>
                                                </div>
                                            </motion.div>
                                        )}

                                        <button onClick={next} disabled={!data.address} className="hidden md:flex w-full bg-laforet-navy text-white font-bold py-5 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg active:scale-95 transition-all justify-center gap-2 items-center text-lg shadow-xl border border-white/20 md:border-0">
                                            Commencer <ArrowRight size={24} />
                                        </button>
                                    </motion.div>
                                )}

                                {step === 1 && (
                                    <motion.div key="step1" initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} className="space-y-8 flex flex-col h-full justify-center">
                                        <h3 className="text-3xl md:text-2xl font-bold text-laforet-navy text-center">Type de bien ?</h3>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <button onClick={() => setData({...data, type: 'Maison'})} className={`p-6 md:p-5 rounded-2xl border-2 flex items-center justify-center gap-4 transition-all ${data.type === 'Maison' ? 'border-laforet-cyan bg-cyan-50 text-laforet-navy shadow-inner' : 'border-gray-100 text-gray-500 hover:border-gray-300'}`}>
                                                <Home size={32} strokeWidth={1.5} /> <span className="font-bold text-xl">Maison</span>
                                            </button>
                                            <button onClick={() => setData({...data, type: 'Appartement'})} className={`p-6 md:p-5 rounded-2xl border-2 flex items-center justify-center gap-4 transition-all ${data.type === 'Appartement' ? 'border-laforet-cyan bg-cyan-50 text-laforet-navy shadow-inner' : 'border-gray-100 text-gray-500 hover:border-gray-300'}`}>
                                                <Building2 size={32} strokeWidth={1.5} /> <span className="font-bold text-xl">Appartement</span>
                                            </button>
                                        </div>

                                        <div className="space-y-6">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-400 md:text-gray-700 mb-2 uppercase tracking-wide">Surface (m²)</label>
                                                <input type="number" inputMode="numeric" pattern="[0-9]*" value={data.surface} onChange={(e) => setData({...data, surface: e.target.value})} className="w-full p-5 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:border-laforet-cyan font-bold text-2xl text-center md:text-left" placeholder="0" />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-400 md:text-gray-700 mb-2 uppercase tracking-wide">Pièces</label>
                                                <input type="number" inputMode="numeric" pattern="[0-9]*" value={data.rooms} onChange={(e) => setData({...data, rooms: e.target.value})} className="w-full p-5 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:border-laforet-cyan font-bold text-2xl text-center md:text-left" placeholder="0" />
                                            </div>
                                        </div>

                                        <button onClick={next} disabled={!data.surface || !data.rooms} className="mt-auto md:mt-0 w-full bg-laforet-navy text-white font-bold py-5 rounded-xl disabled:opacity-50 transition-all text-lg shadow-md">Continuer</button>
                                    </motion.div>
                                )}

                                {step === 2 && (
                                    <motion.div key="step2" initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} className="space-y-6 flex flex-col h-full justify-center">
                                        <div className="text-center mb-4">
                                            <h3 className="text-3xl md:text-2xl font-bold text-laforet-navy">Ses Atouts</h3>
                                            <p className="text-sm text-gray-500 mt-2">Qu'est-ce qui le rend unique ?</p>
                                        </div>
                                        <div className="grid grid-cols-1 gap-3 overflow-y-auto max-h-[50vh] md:max-h-none pr-1">
                                            {BoostersList.map(item => (
                                                <button key={item} onClick={() => toggleItem('boosters', item)} className={`flex items-center justify-between p-5 rounded-xl border transition-all ${data.boosters.includes(item) ? 'border-green-500 bg-green-50 text-green-800 font-bold shadow-sm' : 'border-gray-100 bg-white hover:bg-gray-50 text-gray-600'}`}>
                                                    <span className="text-lg">{item}</span>
                                                    {data.boosters.includes(item) ? <CheckCircle2 size={24} className="text-green-500" /> : <div className="w-6 h-6 rounded-full border border-gray-300" />}
                                                </button>
                                            ))}
                                        </div>
                                        <button onClick={next} className="mt-auto md:mt-0 w-full bg-laforet-navy text-white font-bold py-5 rounded-xl transition-all text-lg shadow-md">Valider</button>
                                    </motion.div>
                                )}

                                {step === 3 && (
                                    <motion.div key="step3" initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} className="space-y-6 flex flex-col h-full justify-center">
                                        <div className="text-center mb-4">
                                            <h3 className="text-3xl md:text-2xl font-bold text-laforet-navy">Défauts ?</h3>
                                            <p className="text-sm text-gray-500 mt-2">Soyons transparents.</p>
                                        </div>
                                        <div className="grid grid-cols-1 gap-3 overflow-y-auto max-h-[50vh] md:max-h-none pr-1">
                                            {FlawsList.map(item => (
                                                <button key={item} onClick={() => toggleItem('flaws', item)} className={`flex items-center justify-between p-5 rounded-xl border transition-all ${data.flaws.includes(item) ? 'border-amber-500 bg-amber-50 text-amber-800 font-bold shadow-sm' : 'border-gray-100 bg-white hover:bg-gray-50 text-gray-600'}`}>
                                                    <span className="text-lg">{item}</span>
                                                    {data.flaws.includes(item) ? <AlertCircle size={24} className="text-amber-500" /> : <div className="w-6 h-6 rounded-full border border-gray-300" />}
                                                </button>
                                            ))}
                                        </div>
                                        <button onClick={next} className="mt-auto md:mt-0 w-full bg-laforet-navy text-white font-bold py-5 rounded-xl transition-all text-lg shadow-md">Calculer</button>
                                    </motion.div>
                                )}

                                {step === 4 && (
                                    <motion.div key="step4" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className="absolute inset-0 z-10 bg-gray-900 md:rounded-2xl flex flex-col items-center justify-center text-center p-6">
                                        <div className="absolute inset-0 map-blur-bg opacity-30"></div>
                                        <div className="relative z-20 w-full max-w-xs space-y-6">
                                            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/10">
                                                <Loader2 className="animate-spin text-laforet-cyan mx-auto mb-4" size={48} />
                                                <h3 className="text-white font-bold text-lg mb-2">Analyse du secteur...</h3>
                                                <div className="w-full bg-gray-700 rounded-full h-2 mb-2 overflow-hidden">
                                                    <motion.div className="bg-laforet-cyan h-full rounded-full" style={{ width: `${loadingProgress}%` }} />
                                                </div>
                                                <div className="text-white/80 text-xs flex flex-col gap-1">
                                                    <p>Vérification cadastre : {data.zipcode}</p>
                                                    <p className="font-bold text-white">" {data.street || data.city} "</p>
                                                    <p className="opacity-70">Croisement des données notariales 2024-2026</p>
                                                </div>
                                            </div>
                                        </div>
                                    </motion.div>
                                )}

                                {step === 5 && (
                                    <motion.div key="step5" initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className="space-y-6 text-center flex flex-col h-full justify-center">
                                        <div className="mx-auto bg-green-50 text-green-700 px-4 py-2 rounded-lg text-sm font-bold inline-flex items-center gap-2 mb-2 w-fit">
                                            <CheckCircle2 size={16} /> Analyse terminée
                                        </div>
                                        
                                        <div className="relative p-6 bg-gray-50 rounded-xl border border-gray-200 mx-auto w-full max-w-sm">
                                            <div className="filter blur-sm select-none opacity-50 space-y-2">
                                                <div className="h-8 bg-gray-300 w-1/2 mx-auto rounded"></div>
                                                <div className="h-4 bg-gray-300 w-3/4 mx-auto rounded"></div>
                                            </div>
                                            <div className="absolute inset-0 flex items-center justify-center">
                                                <div className="bg-white shadow-lg rounded-full p-4 text-laforet-navy">
                                                    <Lock size={32} />
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-2xl font-bold text-laforet-navy mb-2">Résultat prêt</h3>
                                            <p className="text-sm text-gray-500 mb-6 px-4">Où envoyer votre rapport DVF ?</p>
                                            
                                            <div className="space-y-4 text-left max-w-sm mx-auto w-full">
                                                <input type="text" placeholder="Votre nom" className="w-full p-5 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:border-laforet-navy text-lg" value={data.name} onChange={(e) => setData({...data, name: e.target.value})} />
                                                <input type="tel" inputMode="tel" placeholder="Mobile (SMS)" className="w-full p-5 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:border-laforet-navy text-lg" value={data.phone} onChange={(e) => setData({...data, phone: e.target.value})} />
                                                <input type="email" inputMode="email" placeholder="Email" className="w-full p-5 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:border-laforet-navy text-lg" value={data.email} onChange={(e) => setData({...data, email: e.target.value})} />
                                            </div>
                                        </div>

                                        <div className="flex flex-col gap-3 mt-auto md:mt-0 w-full max-w-sm mx-auto">
                                            <button 
                                                onClick={handleSubmit} 
                                                disabled={!data.name || !data.phone || !data.email || isSubmitting} 
                                                className="w-full bg-laforet-navy text-white font-bold py-5 rounded-xl shadow-xl hover:bg-laforet-navy/90 transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-wait text-lg"
                                            >
                                                {isSubmitting ? (
                                                    <>
                                                        <Loader2 className="animate-spin" size={24} /> Traitement...
                                                    </>
                                                ) : (
                                                    <>
                                                        Voir mon estimation <ArrowRight size={24} />
                                                    </>
                                                )}
                                            </button>
                                            
                                            {/* Trust Signals */}
                                            <div className="flex items-center justify-center gap-4 text-xs text-gray-500 mt-2">
                                                <div className="flex items-center gap-1">
                                                    <ShieldCheck size={14} className="text-green-600"/>
                                                    <span>Gratuit</span>
                                                </div>
                                                <div className="flex items-center gap-1">
                                                    <Users size={14} className="text-laforet-navy"/>
                                                    <span>Confidentiel</span>
                                                </div>
                                            </div>
                                        </div>
                                    </motion.div>
                                )}

                                {step === 6 && (
                                    <motion.div key="step6" initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="absolute inset-0 z-10 bg-white md:rounded-2xl flex flex-col items-center justify-center text-center p-6">
                                        <Loader2 className="animate-spin text-laforet-cyan mb-6" size={56} />
                                        <h3 className="text-xl md:text-2xl font-bold text-laforet-navy mb-4 animate-pulse">
                                            {loadingText}
                                        </h3>
                                        <p className="text-gray-500 text-sm">Veuillez ne pas fermer cette page.</p>
                                        
                                        <div className="mt-8 w-64 bg-gray-100 rounded-full h-1.5 overflow-hidden">
                                            <motion.div 
                                                className="bg-laforet-cyan h-full rounded-full"
                                                initial={{ width: 0 }}
                                                animate={{ width: "100%" }}
                                                transition={{ duration: 4 }}
                                            />
                                        </div>
                                    </motion.div>
                                )}

                                {step === 7 && resultData && (
                                    <motion.div key="step7" initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="pb-32 md:pb-0 h-full overflow-y-auto">
                                        
                                        <div className="text-center mb-6 pt-6 md:pt-0">
                                            <div className="inline-block bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold mb-3 uppercase tracking-wide">
                                                Marché : {resultData.neighborhoodLabel}
                                            </div>
                                            <h3 className="text-2xl font-bold text-laforet-navy">Valeur Estimée</h3>
                                            <p className="text-gray-500 text-sm">Marché 2026 • {data.surface}m²</p>
                                        </div>

                                        {/* PRICE CARD */}
                                        <div className="bg-gradient-to-br from-laforet-navy to-[#2a4d9e] p-8 md:p-6 rounded-3xl md:rounded-2xl text-white text-center shadow-2xl shadow-blue-900/20 mb-8 relative overflow-hidden mx-auto max-w-sm md:max-w-none">
                                            <div className="absolute top-0 right-0 p-4 opacity-10"><TrendingUp size={100} /></div>
                                            <p className="text-blue-200 text-sm font-medium mb-2 uppercase tracking-wider">Fourchette Basse - Haute</p>
                                            <div className="text-4xl md:text-4xl font-extrabold tracking-tight mb-4 leading-none">
                                                {Math.round(resultData.low / 1000)}k€ - {Math.round(resultData.high / 1000)}k€
                                            </div>
                                            <div className="inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-1.5 rounded-full text-xs font-medium">
                                                <div className="flex gap-0.5">
                                                    {[...Array(5)].map((_, i) => (
                                                        <Star key={i} size={12} className={i < resultData.confidence ? "fill-yellow-400 text-yellow-400" : "text-blue-200"} />
                                                    ))}
                                                </div>
                                                <span>Confiance : {resultData.confidence}/5</span>
                                            </div>
                                        </div>

                                        {/* CHART & MAP GRID */}
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                            {/* Graphique Simplifié */}
                                            <div className="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                                <h4 className="text-sm font-bold text-gray-700 mb-4 flex items-center gap-2">
                                                    <BarChart3 size={16} /> Prix/m²
                                                </h4>
                                                <div className="space-y-4">
                                                    <div>
                                                        <div className="flex justify-between text-xs mb-1">
                                                            <span className="text-gray-500">Moyenne Secteur</span>
                                                            <span className="font-bold text-gray-700">~2 850 €</span>
                                                        </div>
                                                        <div className="bar-container">
                                                            <div className="bar-fill bg-gray-300" style={{ width: '60%' }}></div>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="flex justify-between text-xs mb-1">
                                                            <span className="text-laforet-navy font-bold">Votre Bien</span>
                                                            <span className="font-bold text-laforet-navy">{resultData.avgM2.toLocaleString()} €</span>
                                                        </div>
                                                        <div className="bar-container">
                                                            <div className="bar-fill bg-laforet-cyan" style={{ width: '85%' }}></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Fake Map Context */}
                                            <div className="hidden md:block bg-gray-200 rounded-xl relative h-32 md:h-auto overflow-hidden border border-gray-300">
                                                <div className="absolute inset-0 map-blur-bg opacity-60"></div>
                                                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-laforet-navy text-white p-2 rounded-full shadow-lg z-10 animate-bounce">
                                                    <MapPin size={24} />
                                                </div>
                                                <div className="absolute bottom-2 left-2 bg-white/80 backdrop-blur px-2 py-1 rounded text-[10px] font-bold text-gray-600">
                                                    3 ventes similaires
                                                </div>
                                            </div>
                                        </div>

                                        {/* Desktop CTAs */}
                                        <div className="hidden md:block space-y-3">
                                            <button className="w-full bg-laforet-navy text-white font-bold py-4 rounded-xl shadow-lg hover:bg-laforet-navy/90 transition-all flex items-center justify-center gap-2">
                                                <Download size={20} /> Télécharger mon Rapport DVF Complet
                                            </button>
                                            <a href="https://calendly.com" target="_blank" className="block w-full bg-white text-laforet-navy border-2 border-laforet-navy font-bold py-3 rounded-xl text-center hover:bg-blue-50 transition-all">
                                                Affiner ma fourchette avec un expert (Gratuit)
                                            </a>
                                        </div>

                                        <p className="text-center text-[10px] text-gray-400 mt-4 leading-snug max-w-sm mx-auto pb-8">
                                            *Estimation indicative. Ne constitue pas une expertise.
                                        </p>

                                        {/* STICKY MOBILE CTA */}
                                        <div className="md:hidden fixed bottom-6 left-6 right-6 z-[60]">
                                            <a href="tel:0246466380" className="w-full bg-[#183C89] text-white font-bold py-4 rounded-full shadow-2xl flex items-center justify-center gap-3 border border-white/20 text-lg">
                                                <Phone size={20} /> Appeler un expert
                                            </a>
                                        </div>

                                    </motion.div>
                                )}

                            </AnimatePresence>
                        </div>
                    </div>
                </section>
            );
        };

        const TeamCard = ({ photo, name, role, desc }) => (
            <motion.div initial={{ opacity: 0, y: 15 }} whileInView={{ opacity: 1, y: 0 }} className="flex gap-4 p-5 rounded-2xl bg-white border border-gray-100 shadow-sm">
                <img src={photo} alt={name} className="w-16 h-16 object-cover rounded-xl flex-shrink-0" />
                <div>
                    <h4 className="text-lg font-bold text-laforet-navy leading-none mb-1">{name}</h4>
                    <p className="text-xs font-bold text-laforet-cyan uppercase mb-2">{role}</p>
                    <p className="text-sm text-gray-500 leading-snug line-clamp-3">{desc}</p>
                </div>
            </motion.div>
        );

        const TeamSection = () => (
            <section className="hidden md:block py-16 px-4 bg-[#F5F5F7]">
                <div className="max-w-7xl mx-auto">
                    <div className="mb-10 text-center">
                        <h2 className="text-2xl md:text-4xl font-bold text-laforet-navy mb-3">L'équipe locale</h2>
                        <p className="text-gray-500 text-sm md:text-base">Des experts de Saint-Avertin à vos côtés.</p>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <TeamCard name="Olivier" role="Franchisé" photo="https://i.postimg.cc/qvCXZQ65/LF2025-26-2.jpg" desc="30 ans de direction dans le bâtiment. Sécurise les dossiers techniques." />
                        <TeamCard name="Vincent" role="Agent Commercial" photo="https://i.postimg.cc/k4h2C3kz/LF2025-18.jpg" desc="Expert en négociation internationale. Maximise le net vendeur." />
                        <TeamCard name="Hélène" role="Agent Commercial" photo="https://i.postimg.cc/PfRDsYj9/LF2025-24-2.jpg" desc="30 ans d'expérience bancaire. Valide les financements acquéreurs." />
                        <TeamCard name="Adrien" role="Agent Commercial" photo="https://i.postimg.cc/ThvY2RQD/LF2025-20-2.jpg" desc="Spécialiste marketing digital. Sublime votre bien." />
                    </div>
                </div>
            </section>
        );

        const LocalInfluenceSection = ({ onCtaClick }) => (
            <section className="hidden md:block py-16 md:py-24 px-4 bg-[#F5F5F7] overflow-hidden border-t border-gray-100">
                <div className="max-w-7xl mx-auto">
                    <div className="text-center mb-12 md:mb-16">
                        <h2 className="text-3xl md:text-4xl font-extrabold text-laforet-navy mb-4 leading-tight">
                            L'Observatoire de l'Immobilier : <br className="hidden md:block"/>Saint-Avertin & Larçay
                        </h2>
                        <p className="text-base md:text-lg text-gray-600 max-w-2xl mx-auto leading-relaxed">
                            Ne vous fiez pas aux estimations nationales. Voici la réalité de notre marché local au 1er janvier 2026.
                        </p>
                    </div>

                    <div className="flex overflow-x-auto snap-x snap-mandatory gap-6 pb-8 md:pb-0 md:grid md:grid-cols-3 md:gap-8 no-scrollbar px-2">
                        
                        {/* CARD 1: PRIX */}
                        <div className="snap-center flex-shrink-0 w-[85vw] md:w-auto bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-gray-100 flex flex-col transition-transform hover:-translate-y-1 duration-300">
                            <div className="flex items-center gap-3 mb-6">
                                <div className="p-3 bg-blue-50 text-laforet-navy rounded-xl">
                                    <TrendingUp size={24} />
                                </div>
                                <h3 className="font-bold text-laforet-navy text-xl">Prix au m² Moyen</h3>
                            </div>
                            <div className="space-y-4 mb-8 flex-grow">
                                <div className="flex justify-between items-baseline border-b border-gray-50 pb-3">
                                    <span className="text-gray-600 font-medium">Saint-Avertin</span>
                                    <span className="text-xl font-bold text-laforet-navy">~2 950 €/m²</span>
                                </div>
                                <div className="flex justify-between items-baseline pt-1">
                                    <span className="text-gray-600 font-medium">Larçay</span>
                                    <span className="text-xl font-bold text-laforet-navy">~2 650 €/m²</span>
                                </div>
                            </div>
                            <div className="bg-gray-50 p-5 rounded-xl border border-gray-100 mt-auto">
                                <p className="text-sm text-gray-600 italic leading-snug">
                                    <span className="font-bold text-laforet-cyan not-italic block mb-2 uppercase text-xs tracking-wider">L'avis de l'expert</span>
                                    "Une stabilité rassurante avec une hausse de +3,7 % sur 5 ans à Larçay."
                                </p>
                            </div>
                        </div>

                        {/* CARD 2: INDICATEURS */}
                        <div className="snap-center flex-shrink-0 w-[85vw] md:w-auto bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-gray-100 flex flex-col transition-transform hover:-translate-y-1 duration-300">
                            <div className="flex items-center gap-3 mb-6">
                                <div className="p-3 bg-blue-50 text-laforet-navy rounded-xl">
                                    <CalendarClock size={24} />
                                </div>
                                <h3 className="font-bold text-laforet-navy text-xl">Indicateurs de Vente</h3>
                            </div>
                            <div className="space-y-5 mb-8 flex-grow">
                                <div className="flex justify-between items-center border-b border-gray-50 pb-3">
                                    <span className="text-gray-600 font-medium">Délai moyen</span>
                                    <span className="text-xl font-bold text-laforet-navy">89 jours</span>
                                </div>
                                <div>
                                    <div className="flex justify-between items-center mb-1">
                                        <span className="text-gray-600 font-medium">Tension</span>
                                        <span className="text-xs font-bold text-red-600 bg-red-100 px-2 py-1 rounded-full uppercase tracking-wide">Forte</span>
                                    </div>
                                    <p className="text-sm text-gray-500 mt-2">Comptez 8 acheteurs actifs pour 1 bien disponible.</p>
                                </div>
                            </div>
                            <div className="bg-gray-50 p-5 rounded-xl border border-gray-100 mt-auto">
                                <p className="text-sm text-gray-600 italic leading-snug">
                                    <span className="font-bold text-laforet-cyan not-italic block mb-2 uppercase text-xs tracking-wider">L'avis de l'expert</span>
                                    "Le marché favorise les vendeurs ayant une stratégie de prix cohérente dès le lancement."
                                </p>
                            </div>
                        </div>

                        {/* CARD 3: ACQUEREURS */}
                        <div className="snap-center flex-shrink-0 w-[85vw] md:w-auto bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-gray-100 flex flex-col transition-transform hover:-translate-y-1 duration-300">
                            <div className="flex items-center gap-3 mb-6">
                                <div className="p-3 bg-blue-50 text-laforet-navy rounded-xl">
                                    <Users size={24} />
                                </div>
                                <h3 className="font-bold text-laforet-navy text-xl">Profil Acquéreurs</h3>
                            </div>
                            <div className="space-y-5 mb-8 flex-grow">
                                <div className="border-b border-gray-50 pb-3">
                                    <span className="block text-gray-600 font-medium mb-1">Cible prioritaire</span>
                                    <span className="text-lg font-bold text-laforet-navy block">Familles & Cadres</span>
                                    <span className="text-xs text-gray-400">Revenu médian > 38k€/an</span>
                                </div>
                                <div>
                                    <span className="block text-gray-600 font-medium mb-1">Recherche Top 1</span>
                                    <span className="text-sm text-gray-700 leading-snug">Maisons 4-6 pièces, jardin & performance énergétique optimisée.</span>
                                </div>
                            </div>
                            <div className="bg-gray-50 p-5 rounded-xl border border-gray-100 mt-auto">
                                <p className="text-sm text-gray-600 italic leading-snug">
                                    <span className="font-bold text-laforet-cyan not-italic block mb-2 uppercase text-xs tracking-wider">L'avis de l'expert</span>
                                    "72 % des habitants de Saint-Avertin sont propriétaires de leur résidence principale."
                                </p>
                            </div>
                        </div>
                    </div>

                    <div className="mt-12 md:mt-16 text-center max-w-3xl mx-auto px-4">
                        <button 
                            onClick={onCtaClick}
                            className="inline-flex items-center justify-center gap-2 bg-laforet-navy text-white font-bold py-4 px-8 rounded-xl shadow-lg hover:bg-laforet-navy/90 transition-all transform active:scale-95 w-full md:w-auto text-lg"
                        >
                            Recevoir mon analyse de marché personnalisée <ArrowRight size={20} />
                        </button>
                    </div>
                </div>
            </section>
        );

        const GoogleReviewsSection = () => (
            <section className="hidden md:block py-16 bg-white border-t border-gray-100 relative">
                <div className="text-center mb-10 px-6">
                    <h2 className="text-2xl md:text-3xl font-bold text-laforet-navy mb-2">Avis Clients</h2>
                    <div className="flex items-center justify-center gap-2 text-amber-500">
                        <div className="flex">
                            {[...Array(5)].map((_, i) => <Star key={i} className="w-5 h-5 fill-current" />)}
                        </div>
                        <span className="text-laforet-navy font-bold text-sm">4.9/5 sur Google</span>
                    </div>
                </div>

                <div className="flex overflow-x-auto snap-x snap-mandatory gap-4 px-4 pb-8 md:grid md:grid-cols-3 md:gap-8 md:overflow-visible no-scrollbar">
                    {googleReviews.map((review, index) => (
                        <div key={index} className="snap-center flex-shrink-0 w-[85vw] md:w-auto p-6 bg-[#F9FAFB] rounded-2xl border border-gray-100 flex flex-col justify-between">
                            <div>
                                <div className="flex gap-0.5 mb-3 text-amber-400">
                                    {[...Array(5)].map((_, i) => <Star key={i} size={14} className="fill-current" />)}
                                </div>
                                <p className="text-gray-600 text-sm italic mb-4 leading-relaxed">"{review.comment}"</p>
                            </div>
                            <p className="font-bold text-laforet-navy text-xs uppercase">{review.author}</p>
                        </div>
                    ))}
                </div>
                
                <div className="text-center mt-4">
                     <a 
                        href="https://share.google/MfdTpW9PIsacXfgmq" 
                        target="_blank" 
                        rel="noopener noreferrer"
                        className="inline-flex items-center gap-2 text-laforet-cyan font-bold text-sm hover:underline"
                    >
                        Lire tous les avis Google <ArrowRight size={16} />
                    </a>
                </div>
            </section>
        );

        const App = () => {
            const scrollToForm = () => {
                const el = document.getElementById('simulator');
                if(el) {
                    const offset = 100;
                    const bodyRect = document.body.getBoundingClientRect().top;
                    const elementRect = el.getBoundingClientRect().top;
                    const elementPosition = elementRect - bodyRect;
                    const offsetPosition = elementPosition - offset;
                    window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                }
            };
            
            return (
                <div className="min-h-screen bg-[#F5F5F7]">
                    <Navbar />
                    <Hero onStart={scrollToForm} />
                    <FormEngine />
                    <TeamSection />
                    <LocalInfluenceSection onCtaClick={scrollToForm} />
                    <GoogleReviewsSection />
                    <footer className="bg-white py-8 text-center text-xs text-gray-400 border-t">
                        <p>&copy; 2026 Laforêt Saint-Avertin. Données DVF mises à jour.</p>
                        <a href="#" className="underline mt-1 block">Mentions Légales</a>
                    </footer>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>